{
  "name": "Haoel.GitHub.io",
  "tagline": "",
  "body": "# 用ASUS Merlin 路由器 VPN 科学上网\r\n\r\n时间：2016-08-09\r\n\r\n## 准备\r\n\r\n- **首先，你需要一台ASUS的路由器**。\r\n\r\n注：朋友安利我的是 **华硕（ASUS） RT-AC68U 1900M AC 双频智能无线路由路**\r\n\r\n- **然后你需要一个VPN**。\r\n\r\n注：我用的是PPTP，可以上AWS日本申请个免费试用一年的EC2 VPS，或是Linode买个一月USD10刀的VPS，然后自建一个PPTP的VPN\r\n\r\n## 路由器设置\r\n\r\n### 刷 merlin 固件\r\n\r\n首先Asuswrt是华硕公司为他的路由器所开发的固件。Asuswrt-merlin是一个对Asuswrt固件二次开发进行各种改进和修正的项目。源代码在这里：[https://github.com/RMerl/asuswrt-merlin](https://github.com/RMerl/asuswrt-merlin)\r\n\r\nMerlin固件拥有更多的功能，由于第三方不断维护代码，各种新功能也在不断增加。Merlin固件的升级并不需要反复的操作过程，方法与官方固件的升级相同，有很好的硬件软件兼容性。继承了Asuswrt官方固件优秀的交互界面。Koolshare论坛所分享的固件大多是基于Merlin代码再次改进，增加适合国内使用的功能。\r\n\r\n另外，不必担心把路由器刷费了，华硕的路由器可以让你一键重置回来\r\n\r\n**1）下载固件**。先到 [https://asuswrt.lostrealm.ca/download](https://asuswrt.lostrealm.ca/download) 下载相应的固件，并解压。（我下载的是 `RT-AC68U_380.61_0.zip` ）\r\n\r\n**2）升级固件**。登录到你的路由器后台 `http://192.168.1.1/，在 `系统管理` -> `固件升级` 中上传固件文件（我上传的是：`RT-AC68U_380.61_0.trx`）\r\n\r\n**3）打开 JFFS 分区**。`系统管理` -> `系统设置` -> `Persistent JFFS2 partition`\r\n\r\n- `Format JFFS partition at next boot` - `否`\r\n- `Enable JFFS custom scripts and configs` - `是`\r\n\r\n\r\n**4）打开 ssh 登录**。 `系统管理` -> `系统设置` -> `SSH Daemon` \r\n\r\n- `Allow SSH password login` - `是`\r\n\r\n\r\n### 连接 VPN\r\n\r\n**1）到 `VPN` -> `PPTP/L2TP Client` 中 添加设置文件。**\r\n\r\n注：最好使用PPTP，设置起来比较简单。L2TP不支持PEK的共享密码。\r\n\r\n**2）保存配置后，点 `Active`， 如果一切正确，可以看到连接成功。**\r\n\r\n\r\n### 设置路由\r\n\r\n此时，你的路由器就VPN了，但是，包括访问中国的网站也被代理了。所以，还要设置一下路由表。\r\n\r\n\r\n```\r\nssh admin@192.168.1.1\r\n```\r\n\r\n#### 下载路由表\r\n\r\n```\r\ncd /jffs\r\nwget https://haoel.github.io/downloads/route.sh\r\n```\r\n\r\n**`route.sh` 怎么来的？**\r\n\r\n- 这个脚本的路由表是由来自这个项目：[https://github.com/fivesheep/chnroutes](https://github.com/fivesheep/chnroutes)\r\n- 这个脚本包含6000多条路由规则，几乎包括了中国的网段。\r\n- 我修改了一下他生成出来的ip-up，其会自动查看路由器的wan的网关。\r\n- 你可以使用 `route.sh add` 来生效路由表，用 `./route.sh delete` 来删除路由表。\r\n\r\n注意，路由器是拨号的，所以，IP和网关会变，因此，如果网关变了，路由表需要被更新。（**因为我刚刚才试用这个路由器，所以乱写了这个脚本，等日后再完善**）\r\n\r\n#### 下载动态DNS配置\r\n\r\n```\r\ncd /jffs/configs\r\nwget https://haoel.github.io/downloads/dnsmasq.conf.add\r\n```\r\n\r\n**`dnsmasq.conf.add`怎么来的？**\r\n\r\n- 这个配置来自 [https://github.com/felixonmars/dnsmasq-china-list](https://github.com/felixonmars/dnsmasq-china-list)\r\n- 因为似乎他没有加上 itunes.apple.com ，所以，我就简单的把 `server=itunes.apple.com/114.114.114.114` 加到了 `accelerated-domains.china.conf` ，然后直接改名为 dnsmasq.conf.add\r\n\r\n\r\n#### 运行命令生效\r\n\r\n```\r\n/jffs/route.sh add \r\nservice restart_dnsmasq\r\n```\r\n\r\n接下来，你需要让你的设备重新连接一下WiFi路由器。\r\n\r\n#### 检查\r\n\r\n你可以使用一些命令在检查，相应的域名是否被CNAME到了正确的地方。\r\n\r\n如：\r\n\r\n```nslookup itunes.apple.com```\r\n\r\n```ping www.google.com```\r\n\r\n```traceroute weibo.com```\r\n\r\n（全文完）\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}